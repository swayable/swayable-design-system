<template>
  <div class='components'>
    <p>
      Themes are still in the review stage, but you can change to
      <button
        class='link'
        @click='toggleTheme'
      >
        <span v-if='darkTheme'>light theme</span>
        <span v-else>dark theme</span>
      </button>
      now.
    </p>
    <div
      v-for='(components, group) in componentGroups'
      :key='group'
      class='mt-5'
    >
      <h3
        v-if='show === "all"'
        class='group capitalize font-heading text-xl'
      >
        {{ group }}
      </h3>
      <div class='mt-3'>
        <div
          v-for='(component, index) in components'
          :key='component.name'
          class='component flex w-full p-2'
          :class='index % 2 === 0 ? "even" : "odd"'
        >
          <span class='flex-grow'>
            <a
              :href='component.href'
            >
              {{ component.name }}
            </a>
          </span>
          <span class='component-status capitalize text-sm'>{{ component.status }}</span>
          <span class='ml-1'>
            {{ statusIcons[component.status] }}
          </span>
        </div>
      </div>
    </div>
  </div>
</template>

<script>
// If you want to use your own tokens here, change the following line to:
// import designTokens from "@/assets/tokens/tokens.raw.json"
// import designTokens from '../../docs.tokens.json'
import _orderBy from 'lodash/orderBy'
import _pick from 'lodash/pick'

export default {
  name: 'Components',
  props: {
    show: {
      type: String,
      default: 'all',
      validator: value => {
        return value.match(/(all|patterns|templates|elements)/)
      },
    },
  },
  data() {
    const darkTheme = document
      .querySelector('html')
      .getAttribute('data-theme') === 'dark'
    const statusIcons = {
      ready: '✅',
      review: '👀',
      planned: '✏️',
      deprecated: '❌',
    }

    return { darkTheme, statusIcons }
  },
  computed: {
    elements() {
      const context = require.context('@/elements/', true, /\.vue$/)
      return this.getComponents(context)
    },
    patterns() {
      const context = require.context('@/patterns/', true, /\.vue$/)
      return this.getComponents(context)
    },
    templates() {
      const context = require.context('@/templates/', true, /\.vue$/)
      return this.getComponents(context)
    },
    componentGroups() {
      const groups = this.show === 'all'
        ? ['elements', 'patterns', 'templates']
        : [this.show]
      return _pick(this, groups)
    },
  },
  mounted() {
    const toggleTheme = window.location.href.includes('theme=toggle')
    if (toggleTheme) this.toggleTheme()
  },
  methods: {
    hrefFromPath(path) {
      const parts = path.replace('src', '/#')
        .replace('.vue', '')
        .split('')
      parts[3] = parts[3].toUpperCase()
      return parts.join('')
    },
    getComponents(context) {
      const components = context.keys().map(key => {
        const component = context(key).default
        component.href = this.hrefFromPath(component.__file)
        return component
      })
      return _orderBy(components, 'name', 'asc')
    },
    toggleTheme() {
      this.darkTheme = !this.darkTheme
      const page = document.querySelector('html')
      if (this.darkTheme) {
        page.setAttribute('data-theme', 'dark')
      } else {
        page.removeAttribute('data-theme')
      }
    },
  },
}
</script>

<style lang="scss">
  .components {
    .component-status { @apply text-grey }
    .group { @apply text-dark }
    .component {
      &.odd { @apply bg-grey-100 }
      &.even { @apply bg-grey-200 }
    }
  }
  [data-theme='dark'] {
    .components {
      .component-status { @apply text-dark }
      .group { @apply text-grey-100 }
      .component {
        &.odd { @apply bg-grey-400 }
        &.even { @apply bg-grey-500 }
      }
    }
  }
</style>

<docs>
  ```jsx
  <components />
  ```
</docs>
